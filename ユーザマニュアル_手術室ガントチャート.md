# 手術室ガントチャート生成ツール ユーザマニュアル

バージョン: 2.3 | 最終更新: 2026年2月 | 対象: 手術室管理部門

## 目次

- [1. ツール概要](#s1)
- [2. 導入・フォルダ構成](#s2)
- [3. 使い方（操作手順）](#s3)
- [4. 入力データ仕様](#s4)
- [5. 出力ファイルの見方](#s5)
- [6. 定義・計算ロジック](#s6)
- [7. 月次運用フロー](#s7)
- [8. トラブルシューティング](#s8)
- [付録：設定値一覧（開発担当者向け）](#s9)

## 1. ツール概要

本ツールは、手術実施データ（Excel）から手術室ごとの稼働状況を日別ガントチャートとして自動生成する**Windows用アプリケーション（exeファイル）**です。

| 項目 | 内容 |
| --- | --- |
| アプリケーション | 手術室ガントチャート.exe |
| 動作OS | Windows 10 / 11 |
| Python環境 | 不要 （exe内に同梱済み） |
| 入力ファイル | ガントチャート-元データ.xlsx |
| 出力ファイル | 手術室ガントチャート-結果.xlsx |
| 所要時間 | 約5〜15秒（初回起動はやや遅い場合あり） |

## 2. 導入・フォルダ構成

### 2.1 配置

以下のファイルを**同一フォルダ**に配置してください。場所はデスクトップや共有ドライブなど任意です。

```
📁 手術室ガントチャート/
├── 手術室ガントチャート.exe       ← ダブルクリックで実行
├── ガントチャート-元データ.xlsx  ← 入力データ（毎月差し替え）
├── 手術室ガントチャート-結果.xlsx ← 出力（自動生成される）
└── ユーザマニュアル.html          ← 本マニュアル
```

> **[WARNING]** 重要：
exeファイルと入力Excelは必ず
同じフォルダ
に置いてください。

### 2.2 インストール

**不要です。** exeファイルを配置するだけで使用できます。Python等のインストールは一切不要です。

## 3. 使い方（操作手順）

### 操作は3ステップ

1**入力データを配置する**

当月の手術実施データを `ガントチャート-元データ.xlsx` として保存します。

2**exeをダブルクリックする**

`手術室ガントチャート.exe` をダブルクリックします。黒い画面が表示され処理が実行されます。

3**出力ファイルを開く**

同じフォルダに `手術室ガントチャート-結果.xlsx` が生成されます。Excelで開いて確認してください。

### 3.1 実行中の画面

```
入力ファイル読み込み: C:\...\ガントチャート-元データ.xlsx
ガントチャート生成完了: C:\...\手術室ガントチャート-結果.xlsx
全24日分のガントチャートを出力しました。
```

### 3.2 初回実行時の注意

> **[WARNING]** Windows SmartScreen警告：
初回に「WindowsによってPCが保護されました」と出る場合は「詳細情報」→「実行」をクリックしてください。署名のないexeに対する標準的な警告で、ツール自体に問題はありません。

> **[WARNING]** ウイルス対策ソフトの誤検知：
一部のウイルス対策ソフトで誤検知される場合があります。exeをホワイトリスト（除外リスト）に追加してください。

> **[DANGER]** 出力Excelを閉じてから実行してください。
手術室ガントチャート-結果.xlsx
をExcelで開いたまま実行すると書き込みエラーになります。

## 4. 入力データ仕様

### 4.1 ファイル要件

| 項目 | 値 | 備考 |
| --- | --- | --- |
| ファイル名 | ガントチャート-元データ.xlsx | 固定（変更不可） |
| シート名 | ガントチャートデータ | 固定（変更不可） |
| 形式 | .xlsx（Excel 2007以降） | .xls は不可 |
| 配置 | exeと同じフォルダ | ― |

> **[INFO]** テンプレートシートについて：
入力ファイルに「テンプレート」シートがある場合、以下の設定を動的に読み取ります。テンプレートシートがない場合はデフォルト値が使用されます。

#### カスタマイズ可能な設定（C2〜C5）


| セル | 読み取る内容 | デフォルト値 |
| --- | --- | --- |
| C2 | 背景色 → 定時のガントバー色 | #A0C8E4（水色） |
| C3 | 背景色 → 臨時のガントバー色 | #6DABD5（濃い水色） |
| C4 | 背景色 → 緊急のガントバー色 | #FF8CCC（ピンク） |
| C5 | フォント名・サイズ → ガントバーのラベル表示フォント | Meiryo UI / 6pt |


#### 出力書式テンプレート（B6:CO17）

テンプレートシートのB6:CO17は、ガントチャート1日分のレイアウト見本です。以下の書式が出力に反映されます。

| 範囲 | 読み取る書式 |
| --- | --- |
| B列〜CO列 | 列幅 |
| 6行目〜17行目 | 行の高さ |
| B6:CO17 全セル | 罫線パターン（線種・太さ） |
| 6行目（B6〜CO6） | ヘッダ行のフォント・配置・時間ラベル |
| B7 | 日付セルのフォント・配置 |
| C7〜C17 | 部屋名セルのフォント |

色・フォント・レイアウトを変更したい場合は、テンプレートシートの該当セルを編集するだけでOKです。exeの再ビルドは不要です。

### 4.2 カラム定義

| カラム名 | 型 | 必須 | 説明 | 例 |
| --- | --- | --- | --- | --- |
| 手術実施管理番号 | 数値/文字列 | ○ | 一意の管理番号 | 1000104765 |
| 手術実施日 | 文字列 | ○ | YYYY/MM/DD形式 | 2025/09/01 |
| 曜日 | 文字列 | ○ | 「○曜日」形式 | 月曜日 |
| 執刀診療科名 | 文字列 | ○ | 正式診療科名 | 総合外科 |
| 実施手術室名 | 文字列 | ○ | 手術室番号 | 01A, 09, ｱﾝｷﾞｵ |
| 入室時刻 | 時刻 | ○ | HH:MM:SS形式 | 08:44:00 |
| 麻酔終了時刻 | 時刻 | ○ | HH:MM:SS形式 | 13:39:00 |
| 実施申込区分 | 文字列 | ○ | 定時 / 臨時 / 緊急 | 定時 |
| 実施手術名０１ | 文字列 | ○ | 手術名称 | 腹腔鏡下結腸悪性腫瘍切除術 |

### 4.3 手術室名の有効値

| 手術室名 | 稼働率計算 | チャート表示 |
| --- | --- | --- |
| 01A | ○（0.5室換算） | ○ |
| 01B | ○（0.5室換算） | ○ |
| 02, 03, 05, 06, 07, 08, 09, 10 | ○（各1.0室） | ○ |
| ｱﾝｷﾞｵ | ×（除外） | ○ |

## 5. 出力ファイルの見方

### 5.1 シート構成

出力ファイル `手術室ガントチャート-結果.xlsx` は以下の**3シート**で構成されます。

| シート順 | シート名 | 内容 |
| --- | --- | --- |
| 1 | ガントチャートデータ | 入力データ（元データ）のコピー。書式を保持してそのまま転記。 |
| 2 | 手術室ガントチャート | 日付順のガントチャート。全曜日（日曜含む）を日付の昇順で表示。 |
| 3 | 手術室ガントチャート・曜日順 | 曜日順のガントチャート。月→火→水→木→金→土→日の順で、同一曜日内は第1週→第2週→...の順に表示。 |

### 5.2 ガントチャートシートの全体構成

| 行 | 内容 |
| --- | --- |
| 1行目 | タイトル |
| 2〜4行目 | 凡例（色分け・稼働率計算の注記） |
| 6行目以降 | 日付ごとのガントチャートブロック（ヘッダ行 + 11部屋行）が繰り返し |

### 5.3 日付ブロックの構成

| 列 | 内容 |
| --- | --- |
| 列B | 日付（MM/DD(曜)）と稼働率（%）。全部屋を縦結合で表示。 |
| 列C | 手術室名（01A 〜 ｱﾝｷﾞｵ の11行） |
| 列D以降 | 8:00〜22:00の時間軸。手術はセルの塗りつぶし＋ラベルで表現。 |

### 5.4 色分け

| 区分 | 色（デフォルト） | サンプル | 変更方法 |
| --- | --- | --- | --- |
| 定時 | 水色（#A0C8E4） |  | テンプレートシートC2セルの背景色を変更 |
| 臨時 | 濃い水色（#6DABD5） |  | テンプレートシートC3セルの背景色を変更 |
| 緊急 | ピンク（#FF8CCC） |  | テンプレートシートC4セルの背景色を変更 |

> **[INFO]** 書式のカスタマイズ：
入力ファイル（
ガントチャート-元データ.xlsx
）の「テンプレート」シートを編集するだけで、次回実行時から自動的に反映されます。exeの再ビルドは不要です。
  - **C2セルの背景色** → 定時のバー色
  - **C3セルの背景色** → 臨時のバー色
  - **C4セルの背景色** → 緊急のバー色
  - **C5セルのフォント名・サイズ** → ガントバーのラベル表示フォント
  - **B6:CO17の書式** → 列幅・行高・罫線・ヘッダフォント・日付フォント・部屋名フォント

### 5.5 曜日順シートの並び順

「手術室ガントチャート・曜日順」シートでは、以下の順で日付が並びます。

| 順序 | 内容 |
| --- | --- |
| 1 | 第1月曜日 → 第2月曜日 → ... → 第5月曜日（あれば） |
| 2 | 第1火曜日 → 第2火曜日 → ... |
| 3 | 第1水曜日 → 第2水曜日 → ... |
| 4 | 第1木曜日 → 第2木曜日 → ... |
| 5 | 第1金曜日 → 第2金曜日 → ... |
| 6 | 第1土曜日 → 第2土曜日 → ... |
| 7 | 第1日曜日 → 第2日曜日 → ...（データがあれば） |

> **[INFO]** 第N週の判定：
月初からの同一曜日の出現回数で決まります。例えば月の1日が水曜なら、1日=第1水曜、8日=第2水曜、15日=第3水曜... となります。

### 5.6 診療科略称一覧

| 正式名称 | 略称 | 正式名称 | 略称 |
| --- | --- | --- | --- |
| 総合外科 | 総 | 眼科 | 眼 |
| 乳腺外科 | 乳 | 循環器内科 | 循 |
| 心臓血管外科 | 心 | 呼吸器外科 | 呼 |
| 整形外科・スポーツ診療科 | 整 | 泌尿器科 | 泌 |
| 形成外科 | 形 | 耳鼻咽喉・頭頚科 | 耳 |
| 産科・婦人科 | 産 | 脳神経外科 | 脳 |
| 腎・高血圧内科 | 腎 | 麻酔科・ペインクリニック | 麻 |
| 小児外科 | 小 |  |  |

## 6. 定義・計算ロジック

### 6.1 稼働率の定義

> **[INFO]** 稼働率（%）= 実稼働時間（分）÷ 利用可能時間（分）× 100

### 6.2 利用可能時間（分母）

| 曜日 | 計算時間帯 | 時間 | 室数 | 利用可能時間 |
| --- | --- | --- | --- | --- |
| 平日（月〜金） | 9:00〜17:00 | 8時間（480分） | 9室 | 4,320分 |
| 土曜 | 9:00〜13:00 | 4時間（240分） | 9室 | 2,160分 |

### 6.3 室数の換算ルール（合計9室）

| 手術室 | 換算係数 | 理由 |
| --- | --- | --- |
| 01A | 0.5 | 小手術室 |
| 01B | 0.5 | 小手術室 |
| 02, 03, 05, 06, 07, 08, 09, 10 | 各1.0 | 標準手術室 |
| ｱﾝｷﾞｵ | 0（除外） | 稼働率計算の対象外 |
| 合計 | 9.0室 | 0.5 + 0.5 + 8 × 1.0 |

### 6.4 実稼働時間（分子）の算出ルール

| 条件 | 処理 | 例 |
| --- | --- | --- |
| 計算時間帯をまたぐ手術 | 時間帯内の部分のみ計上 | 8:30-10:00 → 9:00-10:00の60分のみ |
| 計算時間帯外の手術 | 0分として扱う | 18:00-20:00 → カウントしない |
| 01A / 01B の手術 | 稼働時間 × 0.5 で加算 | 01Aで60分 → 30分として計上 |
| ｱﾝｷﾞｵ の手術 | 計算に含めない | チャートには表示される |

### 6.5 計算例

> **[INFO]** 例：2025/09/01（月曜日）
分母：
480分 × 9室 = 4,320分
分子（抜粋）：
・01A 14:13-15:50 → 計算帯内97分 ×
0.5
= 48.5分
・02 09:03-10:42 → 99分 × 1.0 = 99分
・09 08:44-13:39 → 9:00-13:39 = 279分 × 1.0 = 279分
・ｱﾝｷﾞｵ → 除外（0分）
… 全手術を同様に合算 …
稼働率：
合計 ÷ 4,320 × 100 =
67.2%

### 6.6 時間軸の定義

| 項目 | 値 |
| --- | --- |
| 表示範囲 | 8:00〜22:00 |
| 最小単位 | 10分（1列 = 10分） |
| 1時間あたり列数 | 6列 |
| 総列数 | 90列（15時間 × 6列） |

### 6.7 バー描画の定義

| 項目 | 内容 |
| --- | --- |
| 開始位置 | 入室時刻を10分単位に切り捨てた列 |
| 終了位置 | 麻酔終了時刻を10分単位に切り捨てた列 |
| ラベル | 【診療科略称】-手術名（先頭40文字） |
| 範囲外 | 8:00前開始→8:00列から、22:50超→22:50列で打ち切り |

## 7. 月次運用フロー

| 手順 | 作業内容 | タイミング |
| --- | --- | --- |
| ① | 電子カルテ等から当月の手術実施データをExcel出力 | 月末〜翌月初 |
| ② | ガントチャート-元データ.xlsx としてフォルダに保存（上書きOK） | 同上 |
| ③ | 手術室ガントチャート.exe をダブルクリック | 同上 |
| ④ | 生成された 手術室ガントチャート-結果.xlsx を確認・配布 | 同上 |
| ⑤ | （任意）前月の出力ファイルをリネームまたは別フォルダにアーカイブ | 同上 |

> **[INFO]** ポイント：
出力ファイルは毎回上書きされます。前月分を残したい場合は事前にファイル名を変更してください。例：
手術室ガントチャート-結果_2025年8月.xlsx

## 8. トラブルシューティング

| 症状 | 原因 | 対処 |
| --- | --- | --- |
| ダブルクリックしても一瞬で閉じる | 入力ファイルが見つからない | ガントチャート-元データ.xlsx がexeと同じフォルダにあるか・ファイル名が正しいか確認 |
| 「WindowsによってPCが保護されました」 | SmartScreen警告（初回のみ） | 「詳細情報」→「実行」をクリック |
| ウイルス対策ソフトにブロックされる | PyInstaller製exeの誤検知 | exeをウイルス対策ソフトの除外リストに追加 |
| 出力ファイルが生成されない | シート名の不一致 | 入力Excelのシート名が「ガントチャートデータ」であるか確認 |
| 「Permission denied」エラー | 出力Excelが開いたまま | Excelファイルを閉じてから再実行 |
| バーが表示されない部屋がある | その日その部屋にデータなし | 正常動作。入力データを確認。 |
| 稼働率が想定と異なる | 時刻形式不正・手術室名の表記揺れ | 入力データのHH:MM:SS形式と手術室名を確認 |
| 新診療科が1文字だけ表示される | 診療科略称が未登録 | 開発担当者にソースコード修正＋exe再ビルドを依頼 |
| 文字が切れて見える | 画面解像度/ズーム設定 | Excelのズーム倍率を80%程度に調整 |

## 付録：設定値一覧（開発担当者向け）

以下の設定はソースコード（`generate_gantt_chart.py`）で定義されています。変更にはソースコード修正＋**exeの再ビルド**が必要です。

| 設定項目 | 変数名 | 現在値 |
| --- | --- | --- |
| 入力ファイル名 | INPUT_FILE | ガントチャート-元データ.xlsx |
| 出力ファイル名 | OUTPUT_FILE | 手術室ガントチャート-結果.xlsx |
| 手術室の表示順 | ROOM_ORDER | ["01A","01B","02","03","05","06","07","08","09","10","ｱﾝｷﾞｵ"] |
| 時間範囲 | TIME_START_HOUR / TIME_END_HOUR | 8 / 22 |
| 定時の色 | COLOR_SCHEDULED | デフォルト #A0C8E4（テンプレートC2から動的取得） |
| 臨時の色 | COLOR_URGENT | デフォルト #6DABD5（テンプレートC3から動的取得） |
| 緊急の色 | COLOR_EMERGENCY | デフォルト #FF8CCC（テンプレートC4から動的取得） |
| ラベルフォント名 | LABEL_FONT_NAME | デフォルト Meiryo UI（テンプレートC5から動的取得） |
| ラベルフォントサイズ | LABEL_FONT_SIZE | デフォルト 6pt（テンプレートC5から動的取得） |
| 出力書式テンプレート | TPL_*（各種） | テンプレートシートB6:CO17から動的取得（列幅・行高・罫線・フォント） |
| 室数換算 | ROOM_WEIGHT | 01A:0.5, 01B:0.5, ｱﾝｷﾞｵ:0 |
| 室数合計 | room_count | 9.0 |

### exeビルド手順

```
cd C:\Users\user\source\repos\JuntenNerimaGanttChart
pyinstaller --onefile --name 手術室ガントチャート generate_gantt_chart.py
copy dist\手術室ガントチャート.exe .
```

> **[WARNING]** 注意：
設定変更にはソースコード修正とexe再ビルドが必要です。エンドユーザーが直接変更することはできません。
